!function(){var t,e,u,o,r,d,m,f,g,y,v,i,s,b;function w(t,e){return i.call(t,e)}function a(t,e){var i,s,n,o,r,a,h,c,l,p,u=e&&e.split("/"),d=y.map,m=d&&d["*"]||{};if(t){for(e=(t=t.split("/")).length-1,y.nodeIdCompat&&b.test(t[e])&&(t[e]=t[e].replace(b,"")),"."===t[0].charAt(0)&&u&&(t=u.slice(0,u.length-1).concat(t)),c=0;c<t.length;c++)"."===(p=t[c])?(t.splice(c,1),--c):".."===p&&(0===c||1===c&&".."===t[2]||".."===t[c-1]||0<c&&(t.splice(c-1,2),c-=2));t=t.join("/")}if((u||m)&&d){for(c=(i=t.split("/")).length;0<c;--c){if(s=i.slice(0,c).join("/"),u)for(l=u.length;0<l;--l)if(n=(n=d[u.slice(0,l).join("/")])&&n[s]){o=n,r=c;break}if(o)break;!a&&m&&m[s]&&(a=m[s],h=c)}!o&&a&&(o=a,r=h),o&&(i.splice(0,r,o),t=i.join("/"))}return t}function E(e,i){return function(){var t=s.call(arguments,0);return"string"!=typeof t[0]&&1===t.length&&t.push(null),r.apply(u,t.concat([e,i]))}}function S(t){var e;if(w(g,t)&&(e=g[t],delete g[t],v[t]=!0,o.apply(u,e)),!w(f,t)&&!w(v,t))throw new Error("No "+t);return f[t]}function h(t){var e,i=t?t.indexOf("!"):-1;return-1<i&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function L(t){return t?h(t):[]}f={},g={},y={},v={},i=Object.prototype.hasOwnProperty,s=[].slice,b=/\.js$/,d=function(t,e){var i,s,n=h(t),o=n[0],e=e[1];return t=n[1],o&&(i=S(o=a(o,e))),o?t=i&&i.normalize?i.normalize(t,(s=e,function(t){return a(t,s)})):a(t,e):(o=(n=h(t=a(t,e)))[0],t=n[1],o&&(i=S(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:i}},m={require:function(t){return E(t)},exports:function(t){var e=f[t];return void 0!==e?e:f[t]={}},module:function(t){return{id:t,uri:"",exports:f[t],config:(e=t,function(){return y&&y.config&&y.config[e]||{}})};var e}},o=function(t,e,i,s){var n,o,r,a,h,c=[],l=typeof i,p=L(s=s||t);if("undefined"==l||"function"==l){for(e=!e.length&&i.length?["require","exports","module"]:e,a=0;a<e.length;a+=1)if("require"===(o=(r=d(e[a],p)).f))c[a]=m.require(t);else if("exports"===o)c[a]=m.exports(t),h=!0;else if("module"===o)n=c[a]=m.module(t);else if(w(f,o)||w(g,o)||w(v,o))c[a]=S(o);else{if(!r.p)throw new Error(t+" missing "+o);r.p.load(r.n,E(s,!0),function(e){return function(t){f[e]=t}}(o),{}),c[a]=f[o]}l=i?i.apply(f[t],c):void 0,t&&(n&&n.exports!==u&&n.exports!==f[t]?f[t]=n.exports:l===u&&h||(f[t]=l))}else t&&(f[t]=i)},e=t=r=function(t,e,i,s,n){if("string"==typeof t)return m[t]?m[t](e):S(d(t,L(e)).f);if(!t.splice){if((y=t).deps&&r(y.deps,y.callback),!e)return;e.splice?(t=e,e=i,i=null):t=u}return e=e||function(){},"function"==typeof i&&(i=s,s=n),s?o(u,t,e,i):setTimeout(function(){o(u,t,e,i)},4),r},r.config=function(t){return r(t)},e._defined=f,(e=function(t,e,i){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(i=e,e=[]),w(f,t)||w(g,t)||(g[t]=[t,e,i])}).amd={jQuery:!0},e("libs/almond",function(){}),e("rs/sr3d/Preferences",[],function(){"use strict";function t(t,e){this.dataString=e,this.config=t,this.init(e)}return t.prototype.init=function(t){if(null==t){this.data={name:"SantaRun",unlocked:[]};var e=this.config.data.level;for(let t=0;t<e.length;t++)this.data.unlocked[t]=0;this.save()}else this.data=JSON.parse(t)},t.prototype.save=function(){null!=this.data&&localStorage.setItem("SantaRun",JSON.stringify(this.data))},t.prototype.isUnlocked=function(t){return 0==t||1===this.data.unlocked[t]},t.prototype.saveUnlock=function(t){this.data.unlocked[t]=1,this.save()},t}),e("rs/sr3d/AssetManager",[],function(){"use strict";var e="assets/sounds",o="assets/graphics";function t(t){this.sr3d=t,this.config=t.config,this.init()}return t.prototype.init=function(){var t=this.loadingManager=new THREE.LoadingManager,s=this;t.onLoad=function(){s.loaded=!0,console.log("Assets loaded"),s.onLoad&&s.onLoad.call(s)},t.onProgress=function(t,e,i){s.onProgress&&s.onProgress.call(s,t,e,i)},this.soundOn=!0,this.loaded=!1},t.prototype.load=function(){this.loadAudio(),this.loadTextures(),this.loadSparkAtlas(),this.loadModel()},t.prototype.loadAudio=function(){const s=this,n=new THREE.AudioListener;function t(t,e){var i=new THREE.Audio(n);return new THREE.AudioLoader(s.loadingManager).load(t,function(t){i.setBuffer(t),e&&e.call(s)}),i}this.sr3d.config.general.useBackgroundMusic&&(this.bgSound=t(e+"/bg.mp3",function(){this.bgSound.setLoop(!0),this.bgSound.setVolume(s.config.general.backgroundVolume)})),this.btnClick=t(e+"/btnClick.mp3"),this.firework=t(e+"/firework.mp3"),this.wintune=t(e+"/wintune.mp3"),this.losetune=t(e+"/losetune.mp3"),this.hitcoin=t(e+"/hitcoin.mp3"),this.yahoo=t(e+"/yahoo.mp3"),this.punch0=t(e+"/punch0.mp3")},t.prototype.loadSparkAtlas=function(){const e=this;const t=new THREE.FileLoader(e.loadingManager);t.load("assets/graphics/spark/spark.json",function(t){e.sparkData=JSON.parse(t)});const i=new THREE.TextureLoader(e.loadingManager);i.load("assets/graphics/spark/spark.png",function(t){e.sparkTex=t})},t.prototype.loadTextures=function(){this.sr3d.defaultOptions;var i=this;const t=new THREE.TextureLoader(i.loadingManager);t.load(o+"/lensflare.png",function(t){i.fwTexture=t});const e=new THREE.TextureLoader(i.loadingManager);var s=["shadow.png","snow.png","stars.png","SantaTarget1.png"];for(let t=0;t<s.length;t++){var n=s[t];e.load(o+"/"+n,function(t){var e=t.image.src.split("/").pop().split(".").shift();i[e]=t})}},t.prototype.loadModel=function(){const s=this,t=new THREE.GLTFLoader(s.loadingManager);var e=["ChristmasTree","PineTree_Snow","Snowman","Reindeer","Rock2","Rock4","Santa1","Santa2","Santa3","Gift1","Gift2","Gift3","Gift4"];const i=new THREE.DRACOLoader;i.setDecoderPath("js/draco/"),t.setDRACOLoader(i);for(var n=0;n<e.length;n++)!function(i){t.load("assets/model/"+i+".glb",function(t){var e=t.scene;s[i]=e,s[i+"Animations"]=t.animations,e.traverse(function(t){t.isMesh&&(t.frustumCulled=!1)})})}(e[n])},t.prototype.toggleSound=function(){this.soundOn=!this.soundOn,this.soundOn?(this.bgSound&&this.bgSound.setVolume(this.config.general.backgroundVolume),this.btnClick.setVolume(1),this.firework.setVolume(1),this.wintune.setVolume(1),this.losetune.setVolume(1),this.hitcoin.setVolume(1),this.yahoo.setVolume(1),this.punch0.setVolume(1)):(this.bgSound&&this.bgSound.setVolume(0),this.btnClick.setVolume(0),this.firework.setVolume(0),this.wintune.setVolume(0),this.losetune.setVolume(0),this.hitcoin.setVolume(0),this.yahoo.setVolume(0),this.punch0.setVolume(0))},t}),e("rs/sr3d/ui/HomeScreenHeader",[],function(){"use strict";function t(t){this.hs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-hscreen-header";var e=this.hs.config;this.title=document.createElement("h1"),this.title.className="app-title",this.title.innerHTML=e.strings.APP_TITLE,t.appendChild(this.title),this.info=document.createElement("span"),this.info.className="app-info",this.info.innerHTML=e.strings.APP_INFO,t.appendChild(this.info),this.progress=document.createElement("div"),this.progress.className="app-progress",this.progressInner=document.createElement("div"),this.progressInner.className="app-progress-inner",t.appendChild(this.progress),this.progress.appendChild(this.progressInner),this.setProgress(0),this.logo=document.createElement("img"),this.logo.className="app-logo",this.logo.src="assets/graphics/logo.png",this.logo.onmousedown=function(t){t.preventDefault()},t.appendChild(this.logo)},t.prototype.hideProgress=function(){var t=this.progress;anime({targets:t,opacity:0,easing:"easeOutQuint",complete:function(){t.style.display="none"}})},t.prototype.hideLogo=function(){var t=this.logo,e=this.hs.sr3d.isMobile;anime({targets:t,opacity:0,easing:"easeOutQuint",complete:function(){e?t.style.display="none":(anime.remove(t),anime({targets:t,width:32,marginTop:20,opacity:1}))}})},t.prototype.setProgress=function(t){this.progressInner.style.width=t+"%"},t.prototype.moveTop=function(){this.hideProgress(),this.hideLogo(),anime.remove(this.el),anime({targets:this.el,top:0,translateY:0,easing:"easeOutQuint",duration:1200})},t.prototype.center=function(){var t=this.hs.sr3d.assetManager,e=this.el;anime({targets:this.el,top:"50%",translateY:"-50%",duration:1400,update:function(){t.showDelay&&(anime.remove(e),anime({targets:e,top:0,translateY:0,duration:0}))}})},t}),e("rs/sr3d/ui/HomeScreenMenu",[],function(){"use strict";function t(t){this.hs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-hscreenmenu",this.con=document.createElement("div"),this.con.className="menu-list",t.appendChild(this.con);var t=this.hs.config,e=this.hs;this.addItem(t.strings.NEW_GAME,function(){e.startNewGame()}),t.general.useHelpPanel&&this.addItem(t.strings.HELP,function(){e.showHelp()}),t.general.useCreditPanel&&this.addItem(t.strings.CREDIT,function(){e.showCredit()})},t.prototype.addItem=function(t,e){var i=document.createElement("div");i.className="menu-item",i.innerHTML=t,i.style.opacity=0,this.con.appendChild(i);var s=this.hs.sr3d.assetManager;i.addEventListener("click",function(t){e&&e.call(this),s.btnClick.play()})},t.prototype.show=function(){anime({targets:".rs-hscreenmenu .menu-item",opacity:1,easing:"easeOutQuad",delay:anime.stagger(150,{start:500})})},t}),e("rs/utils/BrowserUtil",[],function(){"use strict";var n={bp:{XS:0,SM:576,MD:768,LG:992,XL:1200,XXL:1500,X3L:1900,X4L:2e3,X5L:3e3},computeStyle:function(t,e,i){return void 0===i&&(i="px"),parseFloat(getComputedStyle(t)[e].replace(i,""))},css:function(t,e){for(var i in e)t.style[i]=e[i]},getPrefix:function(){return n.pf||(window.opera||0<=navigator.userAgent.indexOf(" OPR/")?(n.pf="Webkit",n.browserName="Opera"):"undefined"!=typeof InstallTrigger?(n.pf="Moz",n.browserName="Firefox"):window.safari?(n.pf="Webkit",n.browserName="Safari"):window.chrome?(n.pf="Webkit",n.browserName="Chrome"):document.documentMode||/Edge/.test(navigator.userAgent)?(n.pf="ms",n.browserName="MSIE"):(n.pf="Webkit",n.browserName="Safari"),"Webkit"===n.pf?n.ps="":n.ps="px",""!==n.pf?n.csspf="-"+n.pf.toLowerCase()+"-":n.csspf="",console.log(n.pf)),n.pf},getMouseTouchEvents:function(){return this.isMobile()?{mdown:"touchstart",mmove:"touchmove",mup:"touchend"}:{mdown:"mousedown",mmove:"mousemove",mup:"mouseup"}},isMobile:function(){return void 0===n.imb&&(n.imb=null===document.createElement("span").ontouchstart),n.imb},goFullscreen:function(t){var e=n.isFullscreenSupported();return!!e&&(""===e?t.requestFullScreen():t[e+"RequestFullScreen"]())},exitFullscreen:function(t){var e=n.isFullscreenSupported();return!!e&&(!!n.isFullscreen()&&(""===e?document.cancelFullScreen():document[e+"CancelFullScreen"]()))},fullScreenCallback:function(t,e,i){var s=n.isFullscreenSupported();if(!s)return!1;document.addEventListener(s+"fullscreenchange",e)},isFullscreen:function(){var t=n.isFullscreenSupported();if(!t)return!1;switch(t){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[t+"FullScreen"]}},isFullscreenSupported:function(){var t=n.pf.toLowerCase();return void 0!==document.cancelFullScreen?"":void 0!==document[t+"CancelFullScreen"]&&t}};return n}),e("rs/game/Scroller",["rs/utils/BrowserUtil"],function(e){"use strict";var l,p,u;function t(t){u=e.isMobile()?(l="touchstart",p="touchend","touchmove"):(l="mousedown",p="mouseup","mousemove"),this.el=t,this.el.style.overflow="hidden",this.init()}return t.prototype.init=function(){var i,s,n,o,r=this.el,a=this;function e(){r.scrollTop+=.075*(n-r.scrollTop),a.scrollId=requestAnimationFrame(e)}function h(t){var e=2.5*((o=(t.changedTouches?t.changedTouches[0]:t).clientY)-i),t=r.scrollHeight-a.el.clientHeight,e=s-e;n=e=(e=t<e?t:e)<0?0:e,r.style.cursor="grabbing"}function c(t){r.removeEventListener(u,h),r.removeEventListener(p,c),window.removeEventListener(u,h),window.removeEventListener(p,c),cancelAnimationFrame(a.scrollId),r.style.cursor="grab"}r.addEventListener(l,function(t){o=(t.touches?t.touches[0]:t).clientY,i=o,s=n=r.scrollTop,r.addEventListener(u,h),r.addEventListener(p,c),window.addEventListener(u,h),window.addEventListener(p,c),cancelAnimationFrame(a.scrollId),a.scrollId=requestAnimationFrame(e),r.style.cursor="grab"}),r.addEventListener("mouseover",function(t){r.style.cursor="grab"})},t}),e("rs/game/BasePanel",[],function(){"use strict";function t(t,e){this.width=t||300,this.height=e||300,this.init()}return t.prototype.init=function(){(this.ol=document.createElement("div")).className="rs-game-overlay";var t=this.el=document.createElement("div");t.className="rs-game-panel",t.style.width=this.width+"px",t.style.height=this.height+"px";var e=this.closeBtn=document.createElement("span");e.className="rs-closebtn",e.innerHTML="&times",t.appendChild(e),e.addEventListener("click",this.hide.bind(this)),anime({targets:this.el,translateX:"-50%",translateY:"-50%",duration:0,scale:1})},t.prototype.show=function(){document.body.appendChild(this.ol),document.body.appendChild(this.el),anime.remove(this.el),anime({targets:this.el,opacity:[0,1],duration:800,easing:"easeOutQuint"})},t.prototype.hide=function(){document.body.contains(this.ol)&&document.body.removeChild(this.ol),document.body.contains(this.el)&&document.body.removeChild(this.el)},t.prototype.resize=function(t,e){},t}),e("rs/sr3d/ui/HelpPanel",["rs/game/Scroller","rs/game/BasePanel"],function(e,s){"use strict";t.prototype=Object.create(s.prototype);function t(t){this.callback=t,s.prototype.constructor.call(this)}return(t.prototype.constructor=t).prototype.init=function(){s.prototype.init.call(this);var t=this.el;t.classList.add("rs-sr3d-helppanel"),t.style.width=t.style.height="90%";var i=this.container=document.createElement("div");i.className="rs-helpcontainer",t.appendChild(i),this.scroller=new e(this.container);t=new XMLHttpRequest;t.addEventListener("load",function(t){var e=this.responseText;i.innerHTML=e}),t.open("GET","assets/text/helpcontent.html"),t.send()},t.prototype.hide=function(){s.prototype.hide.call(this),this.callback&&this.callback.call(this)},t}),e("rs/sr3d/ui/CreditPanel",["rs/game/BasePanel"],function(s){"use strict";function t(t){this.sr3d=t,s.prototype.constructor.call(this)}return((t.prototype=Object.create(s.prototype)).constructor=t).prototype.init=function(){s.prototype.init.call(this);var t=this.el;t.classList.add("rs-sr3d-cpanel"),t.style.width="90%",t.style.height="auto";var e=this.content=document.createElement("div"),i=this.sr3d.config.strings;e.innerHTML="<h3>"+i.APP_TITLE+"</h3>",e.innerHTML+="<p>"+i.CREDIT_TEXT+"</p>",t.appendChild(e)},t}),e("rs/sr3d/screen/HomeScreen",["rs/sr3d/ui/HomeScreenHeader","rs/sr3d/ui/HomeScreenMenu","rs/sr3d/ui/HelpPanel","rs/sr3d/ui/CreditPanel"],function(e,i,s,n){"use strict";function t(t){this.sr3d=t,this.loaded=!1,this.config=t.config,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-hscreen",t.style.width=t.style.height="100%",t.style.display="none",this.header=new e(this),this.menu=new i(this),this.hpanel=new s,this.cpanel=new n(this.sr3d)},t.prototype.load=function(){this.el.style.display="block",this.el.appendChild(this.header.el),this.header.center();var t=this.sr3d.assetManager,s=this,e=this.header,i=this.menu;t.onLoad=function(){setTimeout(function(){t.showDelay=!0,e.moveTop(),s.el.appendChild(i.el),i.show(),t.bgSound&&t.bgSound.play()},1500)},t.onProgress=function(t,e,i){s.header.setProgress(e/i*100)},this.sr3d.assetManager.load()},t.prototype.transitionIn=function(){this.el.style.display="block",anime({targets:this.el,translateY:0,easing:"easeOutQuint",opacity:1,duration:1200})},t.prototype.transitionOut=function(){var t=this.el;anime({targets:this.el,translateY:-400,easing:"easeOutQuint",opacity:0,duration:1200,complete:function(){t.style.display="none"}})},t.prototype.show=function(){this.sr3d.root.appendChild(this.el),this.sr3d.assetManager.loaded?this.transitionIn():this.load()},t.prototype.hide=function(){this.sr3d.root.removeChild(this.el),this.transitionOut()},t.prototype.startNewGame=function(){this.sr3d.setGameScreen()},t.prototype.showHelp=function(){this.hpanel.show()},t.prototype.showCredit=function(){this.cpanel.show()},t.prototype.resize=function(t,e){},t}),e("rs/game/ImagePanel",["rs/game/BasePanel"],function(s){"use strict";function t(t){this.callback=t,s.prototype.constructor.call(this)}return((t.prototype=Object.create(s.prototype)).constructor=t).prototype.init=function(){s.prototype.init.call(this),this.el.classList.add("rs-image-panel");var i=this.img=document.createElement("img");i.draggable=!1,this.el.appendChild(this.img),this.el.style.width=this.el.style.height="auto";var e=this;function t(t){e.callback&&e.callback.call(e),e.hide()}this.closeBtn.addEventListener("click",t),i.addEventListener("click",t),i.onload=function(t){var e=i.naturalWidth/i.naturalHeight;i.naturalHeight>=window.innerHeight&&(i.height=.85*window.innerHeight,i.width=i.height*e),i.naturalWidth>=window.innerWidth&&(i.width=.85*window.innerWidth,i.height=i.width/e)}},t.prototype.show=function(t){this.img.src=t,s.prototype.show.call(this)},t.prototype.showAsset=function(t){this.img.src=t.src,s.prototype.show.call(this)},t}),e("rs/sr3d/ReadyPanel",[],function(){"use strict";function t(t){this.gs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-sr3d-readypanel",t.innerHTML="READY"},t.prototype.show=function(){this.el.style.display="block",document.body.appendChild(this.el),anime.remove(this.el),this.el.style.opacity=1,anime({targets:this.el,opacity:.1,direction:"alternate",loop:!0,duration:300,easing:"easeOutQuad"})},t.prototype.hide=function(){this.el.style.display="none",anime.remove(this.el)},t.prototype.countDown=function(e){var i=3,s=this;this.show(),function t(){clearTimeout(s.countId),0<i--?s.countId=setTimeout(t,1e3):(s.hide(),e.call(this))}()},t}),e("rs/game/IconButton",["rs/utils/BrowserUtil"],function(n){"use strict";function t(t,e){this.init(t,e)}return t.prototype.init=function(t,e){var i=this.el=document.createElement("span");i.className=t,n.css(i,{display:"block",cursor:"pointer",borderRadius:"50%",textAlign:"center"});var s=this;e&&i.addEventListener("click",function(t){e.call(s)})},t}),e("rs/sr3d/ui/GameButton",["rs/game/IconButton"],function(i){"use strict";function t(t,e){this.init(t,e)}return((t.prototype=Object.create(i.prototype)).constructor=t).prototype.init=function(t,e){i.prototype.init.call(this,t,e),this.el.classList.add("rs-sr3d-mainbutton")},t.prototype.addClass=function(t){this.el.classList.add(t)},t.prototype.removeClass=function(t){this.el.classList.remove(t)},t}),e("rs/sr3d/ui/GameOverPanel",["rs/game/BasePanel","rs/sr3d/ui/GameButton"],function(s,n){"use strict";function t(t){this.gs=t,this.am=t.sr3d.assetManager,s.prototype.constructor.call(this)}return((t.prototype=Object.create(s.prototype)).constructor=t).prototype.init=function(){s.prototype.init.call(this);var t=this.el;t.classList.add("rs-trophy-panel"),t.style.width=t.style.height="90%",this.title=document.createElement("h1"),this.title.className="trophy-level-title",this.title.innerHTML="Level Up";var e=this.meta=document.createElement("div");e.className="meta-container",t.appendChild(e);var i=this.panelText=document.createElement("span");i.innerHTML="BEST SCORE: 100",e.appendChild(i);e=document.createElement("div");e.className="trophy-container";i=document.createElement("img");i.src="assets/graphics/sad_santa.png",i.draggable=!1,e.appendChild(i),t.appendChild(e);e=this.btnContainer=document.createElement("div");e.className="trophy-button-container",t.appendChild(e),this.replayBtn=new n("icon-undo",this.doReplay.bind(this)),e.appendChild(this.replayBtn.el),this.closeBtn.style.display="none"},t.prototype.show=function(){document.body.appendChild(this.ol),document.body.appendChild(this.el);anime.remove(this.el),anime({targets:this.el,opacity:[0,1],translateX:"-50%",translateY:"-50%",scale:[0,1],duration:1e3,easing:"easeOutQuint"}),this.setScore(this.gs.getBestScore())},t.prototype.setScore=function(t){this.panelText.innerHTML="BEST SCORE: "+t},t.prototype.hide=function(){s.prototype.hide.call(this)},t.prototype.doReplay=function(){this.am.btnClick.play(),this.gs.replayLevel()},t}),e("rs/sr3d/ui/GameScreenButtonBar",["rs/sr3d/ui/GameButton"],function(e){"use strict";function t(t){this.gs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-sr3d-gamebuttonbar";this.gs.sr3d.assetManager;this.levelBtn=new e("icon-stack",this.showGameLevels.bind(this)),this.levelBtn.addClass("rs-sr3d-mainbutton-extra"),this.infoBtn=new e("icon-info",this.showHelp.bind(this)),t.appendChild(this.infoBtn.el),this.homeBtn=new e("icon-home",this.showHome.bind(this)),t.appendChild(this.homeBtn.el),this.soundBtn=new e("icon-sound-on",this.toggleSound.bind(this)),this.soundBtn.isOn=!0,t.appendChild(this.soundBtn.el)},t.prototype.show=function(){anime({targets:this.el,bottom:15,easing:"easeOutQuint",duration:800})},t.prototype.hide=function(){anime({targets:this.el,bottom:-50,easing:"easeOutQuint",duration:800})},t.prototype.showGameLevels=function(){this.gs.game3d.container.isShuffling||(this.gs.sr3d.assetManager.btnClick.play(),this.gs.levelPanel.show(),this.gs.game3d.setPauseState())},t.prototype.showHome=function(t){this.gs.sr3d.assetManager.btnClick.play(),this.gs.sr3d.setHomeScreen()},t.prototype.showHelp=function(t){this.gs.sr3d.assetManager.btnClick.play(),this.gs.hpanel.show(),this.gs.game3d.setPauseState()},t.prototype.toggleSound=function(){var t=this.gs.sr3d.assetManager,e=this.soundBtn;e.isOn=!this.soundBtn.isOn,e.isOn?(e.removeClass("icon-sound-off"),e.addClass("icon-sound-on"),t.btnClick.play()):(e.removeClass("icon-sound-on"),e.addClass("icon-sound-off")),t.toggleSound()},t.prototype.getClientSize=function(){return[this.el.clientWidth,this.el.clientHeight]},t}),e("rs/sr3d/ui/GameScreenWonBar",["rs/sr3d/ui/GameButton"],function(e){"use strict";function t(t){this.gs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-sr3d-gamewonbar",t.style.bottom="-85px",this.status=document.createElement("h1"),this.status.className="trophy-level-title",this.status.innerHTML="DRAW",this.nextBtn=new e("icon-nextlevel",this.doNext.bind(this)),this.nextBtn.addClass("rs-sr3d-mainbutton-extra"),t.appendChild(this.nextBtn.el)},t.prototype.doNext=function(){this.gs.sr3d.assetManager.btnClick.play(),this.gs.nextLevel()},t.prototype.show=function(t){anime({targets:this.el,bottom:12,easing:"easeOutQuint",duration:800}),this.setStatus(t),document.body.appendChild(this.status)},t.prototype.setStatus=function(t){this.status.innerHTML=t},t.prototype.hide=function(t){anime({targets:this.el,bottom:-85,easing:"easeOutQuint",duration:800}),document.body.contains(this.status)&&document.body.removeChild(this.status)},t}),e("rs/sr3d/ui/GameScreenLoseBar",["rs/sr3d/ui/GameButton"],function(e){"use strict";function t(t){this.gs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-sr3d-gamewonbar",t.style.bottom="-85px",this.replayBtn=new e("icon-undo",this.doReplay.bind(this)),this.replayBtn.addClass("rs-sr3d-mainbutton"),t.appendChild(this.replayBtn.el),this.status=document.createElement("h1"),this.status.className="trophy-level-title",this.status.innerHTML="DRAW"},t.prototype.doReplay=function(){this.gs.sr3d.assetManager.btnClick.play(),this.gs.replayLevel()},t.prototype.show=function(t){anime({targets:this.el,bottom:12,easing:"easeOutQuint",duration:800}),this.setStatus(t),document.body.appendChild(this.status)},t.prototype.hide=function(){anime({targets:this.el,bottom:-85,easing:"easeOutQuint",duration:800}),document.body.contains(this.status)&&document.body.removeChild(this.status)},t.prototype.setStatus=function(t){this.status.innerHTML=t},t}),e("rs/sr3d/ui/HeartBar",[],function(){"use strict";let n=3;const o="#f24437";function t(t){this.gs=t,n=t.sr3d.defaultOptions.maxHealth,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-heartbar";for(var e=this.hlist=[],i=0;i<n;i++){var s=document.createElement("span");s.className="rs-heart-item icon-heart",s.style.color=o,t.appendChild(s),e.push(s)}this.reset()},t.prototype.setValue=function(t){this.value=t,this.setHeartColor(n,"#333333"),this.setHeartColor(t,o)},t.prototype.setHeartColor=function(t,e){for(var i=0;i<t;i++)this.hlist[i].style.color=e},t.prototype.decreaseHealth=function(){return this.value--,this.value<=0||(this.setValue(this.value),!1)},t.prototype.reset=function(){this.value=n,this.setValue(n,o)},t}),e("rs/sr3d/ui/HeaderLevelButton",[],function(){"use strict";function t(t){this.gh=t,this.init()}return t.prototype.init=function(){const t=this.el=document.createElement("div");t.className="rs-sr3d-levelbtn";this.gh;this.label=document.createElement("span"),this.label.className="levelbtn-label",t.appendChild(this.label),this.btn=document.createElement("span"),this.btn.className="levelbtn-shuffle icon-shuffle",this.setLevel(0)},t.prototype.setLevel=function(t){function e(){return Math.floor(150*Math.random())}this.label.innerHTML="Score: "+t,this.el.style.backgroundColor="rgba("+e()+", "+e()+", "+e()+", 0.65)"},t}),e("rs/sr3d/ui/GameScreenHeader",["rs/sr3d/ui/HeartBar","rs/sr3d/ui/HeaderLevelButton"],function(e,i){"use strict";function t(t){this.gs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-sr3d-gameheader",this.levelBtn=new i(this),t.appendChild(this.levelBtn.el),this.hbar=new e(this.gs),t.appendChild(this.hbar.el)},t.prototype.getClientSize=function(){return[this.el.clientWidth,this.el.clientHeight]},t.prototype.show=function(){anime({targets:this.el,top:4,easing:"easeOutQuint",duration:800})},t.prototype.hide=function(){anime({targets:this.el,top:-60,easing:"easeOutQuint",duration:800})},t.prototype.countDown=function(t){},t}),e("rs/three/BaseApp",[],function(){"use strict";function t(t,e,i){this.width=t||1e3,this.height=e||600,this.fov=i||60,this.init()}return t.prototype.init=function(){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.fov,this.width/this.height,1,5e4);var t=this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});t.setSize(this.width,this.height),t.setPixelRatio(window.devicePixelRatio),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.el=t.domElement,this.raycaster=new THREE.Raycaster},t.prototype._renderRequest=function(t){this.renderer.render(this.scene,this.camera),this.rId=requestAnimationFrame(this._renderRequest.bind(this))},t.prototype.startRendering=function(){this.stopRendering(),this.rId=requestAnimationFrame(this._renderRequest.bind(this))},t.prototype.stopRendering=function(){cancelAnimationFrame(this.rId)},t.prototype.resizeHandler=function(){this.thfov=Math.tan(this.camera.fov*Math.PI/360)},t.prototype.setCameraMatchProjection=function(t){t=t||1;var e=this.camera,i=.5*this.height/Math.tan(e.fov*Math.PI/360);e.position.x=e.position.y=0,e.position.z=i/t,e.lookAt(new THREE.Vector3(0,0,0))},t.prototype._getScaleFitRatio=function(t,e,i){i=i||.75;t=this.width/(t/e)>this.height?this.height*i/e:this.width*i/t;return t},t.prototype.getScaleFitPositionZ=function(t,e,i){this.setCameraMatchProjection();e=this._getScaleFitRatio(t,e,i),i=this.camera.position.z;return i-i/e},t}),e("rs/utils/ObjectUtil",[],function(){"use strict";var s={merge:function(t,e,i){for(var s in t)"[object Object]"===Object.prototype.toString.call(t[s])?(void 0===e[s]&&(e[s]={}),this.merge(t[s],e[s])):e[s]=t[s];return e},clone:function(t,e){var i={};return s.merge(t,i,e),i}};return s}),e("rs/game3d/Firework3DState",[],function(){"use strict";return{EXPLODED:0,FALLING:1,EXPIRED:2}}),e("rs/game3d/Firework3D",["rs/utils/ObjectUtil","rs/game3d/Firework3DState"],function(e,o){"use strict";var r=[16777215,16776960,14352128,16711844,15990528];function t(t){this.config={launchHeight:300,sphereRadius:200,color:16763904,size:72,numParticles:24},e.merge(t=t||{},this.config),this.state=o.EXPLODED,this.init()}return((t.prototype=Object.create(THREE.Points.prototype)).constructor=t).prototype.init=function(){THREE.Points.prototype.constructor.call(this);var t=this.config;this.geometry=new THREE.Geometry;for(var e=this.geometry.vertices,i=0;i<t.numParticles;i++){var s=new THREE.Vector3;s.tX=2*Math.random()*t.sphereRadius-t.sphereRadius+50,s.tY=2*Math.random()*t.sphereRadius-t.sphereRadius+50,s.tZ=2*Math.random()*t.sphereRadius-t.sphereRadius+50,e.push(s)}this.geometry.verticesNeedUpdate=!0;var n=r[Math.floor(Math.random()*r.length)];this.material=new THREE.PointsMaterial({size:t.size,color:n,opacity:1,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1,map:t.map}),this.material.needsUpdate=!0},t.prototype.setRegion=function(t,e){this.regionWidth=t,this.regionHeight=e},t.prototype.update=function(t){var e=this.geometry.vertices;if(this.state==o.EXPLODED){for(var i=0;i<e.length;i++)(s=e[i]).x+=.1*(s.tX-s.x),s.y+=.1*(s.tY-s.y),s.z+=.1*(s.tZ-s.z);Math.abs(s.tX-s.x)<5&&(this.state=o.FALLING)}else{for(var s,n=-80*t,i=0;i<e.length;i++)(s=e[i]).vy+=n,s.y+=s.vy;this.material.opacity+=.025*(0-this.material.opacity),this.material.opacity<=.05&&this.reset()}this.geometry.verticesNeedUpdate=!0},t.prototype.reset=function(){var t;this.regionWidth&&(this.position.x=Math.random()*this.regionWidth-.5*this.regionWidth,t=this.regionHeight-this.config.launchHeight,this.position.y=Math.random()*t-.5*t),this.state=o.EXPLODED,this.material.opacity=1,this.material.color.set(r[Math.floor(Math.random()*r.length)]),this.rotation.z=0;for(var e=this.geometry.vertices,i=this.config,s=0;s<e.length;s++){var n=e[s];n.x=n.y=n.z=n.vy=0,n.tX=2*Math.random()*i.sphereRadius-i.sphereRadius+50,n.tY=2*Math.random()*i.sphereRadius-i.sphereRadius+50,n.tZ=2*Math.random()*i.sphereRadius-i.sphereRadius+50}this.geometry.verticesNeedUpdate=!0,this.material.needsUpdate=!0,i.callback&&i.callback.call(this)},t}),e("rs/game3d/Firework3DSet",["rs/utils/ObjectUtil","rs/game3d/Firework3D","rs/game3d/Firework3DState"],function(i,n,t){"use strict";function e(t,e){this.g3d=t,this.config={numFireworks:3,interval:500},i.merge(e=e||{},this.config),this.init()}return((e.prototype=Object.create(THREE.Group.prototype)).constructor=e).prototype.init=function(){THREE.Group.prototype.constructor.call(this);for(var t=this.config,e=this.g3d.gs.sr3d.assetManager.fwTexture,i=0;i<t.numFireworks;i++){var s=new n({map:e,callback:t.callback});this.add(s)}},e.prototype.update=function(t){for(var e=0;e<this.children.length;e++)this.children[e].update(t)},e.prototype.changeRegion=function(e,i){this.children.forEach(function(t){t.setRegion(e,i)})},e.prototype.reset=function(){this.children.forEach(function(t){t.reset()})},e}),e("rs/sr3d/CoinCounter",[],function(){"use strict";function t(){this.init()}return t.prototype.init=function(){const t=this.el=document.createElement("div");t.className="coin-counter",document.body.appendChild(t),this.coin=0},t.prototype.show=function(t,e,i){this.coin+=i,this.el.innerHTML=this.coin;let s=this.el.style;s.display="block",s.top=e+"px",s.left=t+"px",s.color=0<i?"#b2d235":"#ec008c";const n=this;anime({targets:this.el,top:e-500,opacity:[1,0],easing:"easeOutQuad",duration:2400,complete:function(){n.hide()}})},t.prototype.hide=function(){this.el.style.display="none"},t.prototype.reset=function(){this.coin=0},t}),e("rs/sr3d/SparkAnimation",[],function(){"use strict";function t(t){this.pb=t,this.am=t.am,this.init()}return((t.prototype=Object.create(THREE.Mesh.prototype)).constructor=t).prototype.init=function(){THREE.Mesh.prototype.constructor.call(this);const t=this.am;this.fdata=[],this.flist=[];var e,i=t.sparkData.frames,s=t.sparkTex.image.width,n=t.sparkTex.image.height;for(e in i){var o=i[e].frame;const r=t.sparkTex.clone();this.fdata[e]={repeat:[o.w/s,o.h/n],offsetX:o.x/s,offsetY:1-o.h/n-o.y/n},r.repeat.set(o.w/s,o.h/n),r.offset.x=o.x/s,r.offset.y=1-o.h/n-o.y/n,this.flist[e]=r}this.geometry=new THREE.PlaneBufferGeometry(20,40),this.material=new THREE.MeshBasicMaterial({depthTest:!1,blending:THREE.AdditiveBlending,transparent:!0,map:t.sparkTex}),this.reset()},t.prototype.update=function(t){var e;this.visible&&(e=this.pb.santa,this.position.z=e.position.z+2,this.position.x=e.position.x,this.etime+=t,t=Math.floor(45*this.etime)%12,t=this.fdata[t],this.material.map.repeat.set(t.repeat[0],t.repeat[1]),this.material.map.offset.x=t.offsetX,this.material.map.offset.y=t.offsetY)},t.prototype.reset=function(){this.etime=0,this.visible=!1},t.prototype.show=function(){this.visible=!0;const t=this;clearTimeout(this.showId),this.showId=setTimeout(function(){t.visible=!1},400)},t}),e("rs/sr3d/entity/Stars",["rs/utils/ObjectUtil"],function(i){"use strict";function t(t,e){this.pb=t,this.am=t.am,this.config={size:14,numParticles:80,range:200},i.merge(e=e||{},this.config),this.init()}return((t.prototype=Object.create(THREE.Points.prototype)).constructor=t).prototype.init=function(){THREE.Points.prototype.constructor.call(this);var e=this.config;this.geometry=new THREE.Geometry;const i=this.geometry.vertices;var s=e.range,n=2*s;for(let t=0;t<e.numParticles;t++){const o=new THREE.Vector3;o.x=Math.random()*n-.5*n,o.y=100*Math.random(),o.z=-Math.random()*s-200,i.push(o)}this.geometry.verticesNeedUpdate=!0,this.material=new THREE.PointsMaterial({size:e.size,opacity:1,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1,map:this.am.stars}),this.material.needsUpdate=!0,this.reset()},t.prototype.update=function(t){},t.prototype.reset=function(){anime.remove(this.scale),anime({targets:this.scale,x:[1,1.25],y:[1,1.25],z:[1,1.25],easing:"linear",duration:2e3,direction:"alternate",loop:!0})},t}),e("rs/sr3d/entity/Obstacle",[],function(){"use strict";function t(t){this.pb=t,this.am=t.am,this.init()}return((t.prototype=Object.create(THREE.Group.prototype)).constructor=t).prototype.init=function(){THREE.Group.prototype.constructor.call(this);var t=["ChristmasTree","PineTree_Snow","Snowman","Reindeer","Rock2","Rock4"],t=this.selectedName=t[Math.floor(Math.random()*t.length)];const e=this.model=THREE.SkeletonUtils.clone(this.am[t]);e.scale.set(5.5,5.5,5.5),"Snowman"!==t&&"Reindeer"!==t&&(this.rotation.y=2*Math.random()*Math.PI),"Reindeer"===t&&(this.mixer=new THREE.AnimationMixer(this.model),this.clipNames=["Run"],this.animName="ReindeerAnimations"),this.add(e),this.reset()},t.prototype.play=function(t){this.currentAction&&this.currentAction.fadeOut(.5);t=THREE.AnimationClip.findByName(this.am[this.animName],t);const e=this.mixer.clipAction(t);this.currentAction=e,e.clampWhenFinished=!0,e.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play()},t.prototype.playRandom=function(){var t=this.clipNames[Math.floor(Math.random()*this.clipNames.length)];this.play(t)},t.prototype.hit=function(){this.isHit||(this.isHit=!0,this.am.punch0.play())},t.prototype.selfRemove=function(){const e=this.pb;e.remove(this);for(let t=e.opieces.length-1;0<=t;t--)if(e.opieces[t]===this)return e.opieces.splice(t,1),void e.opool.free(this)},t.prototype.animate=function(t){this.position.z+=t*this.pb.dopt.deerSpeed;var e=this.pb.dopt.blockSize,i=-this.position.z+.5*e,e=Math.ceil(i/e)-1;this.ti=-e,this.mixer.update(t)},t.prototype.reset=function(){this.isHit=!1,this.scale.set(1,1,1)},t}),e("rs/sr3d/entity/ObstaclePool",["rs/sr3d/entity/Obstacle"],function(i){"use strict";function t(t){this.pb=t,this.init()}return t.prototype.init=function(){this.pool=[];this.pb;for(var t=0;t<2;t++){var e=new i(this.pb);this.pool.push(e)}},t.prototype.obtain=function(){var t;return(t=0<this.pool.length?this.pool.pop():new i(this.pb)).reset(),t},t.prototype.free=function(t){this.pool.push(t)},t}),e("rs/sr3d/entity/Gift",[],function(){"use strict";function t(t){this.pb=t,this.am=t.am,this.init()}return((t.prototype=Object.create(THREE.Group.prototype)).constructor=t).prototype.init=function(){THREE.Group.prototype.constructor.call(this);const t=this.model=THREE.SkeletonUtils.clone(this.am["Gift"+(Math.floor(4*Math.random())+1)]);t.scale.set(3.5,3.5,3.5),t.rotation.y=2*Math.random()*Math.PI,this.add(t)},t.prototype.hit=function(){this.isHit=!0;const t=this.am;t.yahoo.play(),t.hitcoin.isPlaying&&t.hitcoin.stop(),t.hitcoin.play(),anime.remove(this.position),anime({targets:this.position,y:30,easing:"easeOutQuint",duration:600}),anime.remove(this.rotation),anime({targets:this.rotation,y:2*Math.random()*Math.PI,easing:"easeOutQuad",duration:1e3})},t.prototype.selfRemove=function(){const e=this.pb;e.remove(this);for(let t=e.gpieces.length-1;0<=t;t--)if(e.gpieces[t]===this)return e.gpieces.splice(t,1),void e.gpool.free(this)},t.prototype.reset=function(){this.isHit=!1,anime.remove(this.position),this.scale.set(1,1,1)},t}),e("rs/sr3d/entity/GiftPool",["rs/sr3d/entity/Gift"],function(i){"use strict";function t(t){this.pb=t,this.init()}return t.prototype.init=function(){this.pool=[];this.pb;for(var t=0;t<2;t++){var e=new i(this.pb);this.pool.push(e)}},t.prototype.obtain=function(){var t;return(t=new i(this.pb)).reset(),t},t.prototype.free=function(t){this.pool.push(t)},t}),e("rs/sr3d/entity/Santa",["rs/sr3d/SparkAnimation"],function(t){"use strict";function e(t,e){this.pb=t,this.am=t.am,this.speed=t.dopt.santaSpeed,this.stype=e||1,this.init()}return((e.prototype=Object.create(THREE.Group.prototype)).constructor=e).prototype.init=function(){THREE.Group.prototype.constructor.call(this),this.animName="Santa"+this.stype+"Animations",this.walkClip="Santa"+this.stype+"Armature|Walk";const t=this.model=this.am["Santa"+this.stype];t.scale.set(5,5,5),this.add(t),this.rotation.y=Math.PI,this.mixer=new THREE.AnimationMixer(this.model);const e=this.targetPlane=new THREE.Mesh(new THREE.PlaneBufferGeometry(12,12),new THREE.MeshBasicMaterial({map:this.am.SantaTarget1,transparent:!0,opacity:1}));e.rotation.x=-Math.PI/2,this.add(e);const i=this.fpoint=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshBasicMaterial({color:16763904}));i.visible=!1,i.position.set(-2,30,-35),this.add(i),this.reset()},e.prototype.play=function(t){this.currentAction&&this.currentAction.fadeOut(.5);t=THREE.AnimationClip.findByName(this.am[this.animName],t);const e=this.mixer.clipAction(t);this.currentAction=e,e.clampWhenFinished=!0,e.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play()},e.prototype.playWalk=function(){this.play(this.walkClip)},e.prototype.playOnce=function(t){this.currentAction&&this.currentAction.fadeOut(.5);t=THREE.AnimationClip.findByName(this.am[this.animName],t);const e=this.mixer.clipAction(t);this.currentAction=e,e.clampWhenFinished=!0,e.reset().setLoop(THREE.LoopOnce,1).setEffectiveTimeScale(1).setEffectiveWeight(1).play()},e.prototype.update=function(t){var e=this.pb.dopt,i=e.blockSize;this.targetPlane.rotation.z+=.05,this.mixer.update(t);e=t*e.santaSpeed;this.position.z-=e,this.pb.stars.position.z-=e;i=Math.ceil((-this.position.z+.5*i)/i)-1;i>=this.nextShift&&(this.nextShift+=10,this.pb.floor.shiftForward()),10+i>=this.nextGenShift&&(this.pb.generateLevel(this.nextGenShift),this.nextGenShift+=40)},e.prototype.getMatrixPosition=function(){var t=this.pb.dopt.blockSize,e=this.position.x+.5*t+3*t,i=Math.ceil(e/t)-1,e=-this.position.z+.5*t;return[-(Math.ceil(e/t)-1),i]},e.prototype.reset=function(){this.nextShift=10,this.ti=0,this.tj=3,this.nextGenShift=40,this.position.set(0,0,0)},e.prototype.hitObstacle=function(){this.blink()},e.prototype.blink=function(){let e=0;const i=this;this.isBlinking=!0,function t(){clearTimeout(i.blinkId),e++<12?(i.visible=!i.visible,i.blinkId=setTimeout(t,50)):(i.visible=!0,i.isBlinking=!1)}()},e.prototype.shiftLeft=function(){const t=this;var e,i=this.tj;0!=i&&(e=--i*(e=this.pb.dopt.blockSize)+3*-e,this.tj=i,anime.remove(this.model.rotation),anime({targets:this.model.rotation,y:.5*Math.PI,duration:300,easing:"easeOutQuint"}),clearTimeout(this.rotId),this.rotId=setTimeout(function(){anime.remove(t.model.rotation),anime({targets:t.model.rotation,y:0,duration:400,easing:"easeOutQuint"})},200),anime.remove(this.position),anime({targets:this.position,x:e,duration:800,easing:"easeOutQuint"}))},e.prototype.shiftRight=function(){const t=this;var e,i=this.tj;6!=i&&(e=++i*(e=this.pb.dopt.blockSize)+3*-e,this.tj=i,anime.remove(this.model.rotation),anime({targets:this.model.rotation,y:.5*-Math.PI,duration:300,easing:"easeOutQuint"}),clearTimeout(this.rotId),this.rotId=setTimeout(function(){anime.remove(t.model.rotation),anime({targets:t.model.rotation,y:0,duration:400,easing:"easeOutQuint"})},200),anime.remove(this.position),anime({targets:this.position,x:e,duration:800,easing:"easeOutQuint"}))},e}),e("rs/sr3d/entity/Floor",[],function(){"use strict";function t(t){this.rs=t,this.am=t.am,this.dopt=t.dopt,this.init()}return((t.prototype=Object.create(THREE.Group.prototype)).constructor=t).prototype.init=function(){THREE.Group.prototype.constructor.call(this);var t=this.dopt.blockSize;this.gridSize=21*t;const e=this.am.snow;e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.set(7,40);var i=new THREE.MeshBasicMaterial({map:e,color:15658734,depthWrite:!1});const s=this.gridPlane=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),i);s.rotation.x=-Math.PI/2,s.isFloor=!0,this.add(s),this.gridPlane.scale.set(7*t,40*t),this.config(7,40)},t.prototype.selfAlign=function(){this.position.z=this.offsetZ=-(this.currentLineHeight-5)*this.dopt.blockSize*.5},t.prototype.createGrid=function(t){var e=t||{linesWidth:7,linesHeight:40,color:10066329},i=this.dopt.blockSize;e.width=i*e.linesWidth*.5,e.height=i*e.linesHeight*.5;for(var t=new THREE.LineBasicMaterial({color:e.color}),i=new THREE.Object3D,s=new THREE.Geometry,n=2*e.width/e.linesWidth,o=2*e.height/e.linesHeight,r=-e.height;r<=e.height;r+=n)s.vertices.push(new THREE.Vector3(-e.width,r,0)),s.vertices.push(new THREE.Vector3(e.width,r,0));for(r=-e.width;r<=e.width;r+=o)s.vertices.push(new THREE.Vector3(r,-e.height,0)),s.vertices.push(new THREE.Vector3(r,e.height,0));t=new THREE.LineSegments(s,t);return i.add(t),i.rotation.x=Math.PI/2,i},t.prototype.getMatrixPosition=function(t){var e=this.dopt.blockSize,i=this.currentLineHeight,s=this.currentLineWidth,n=t.x/(this.currentLineWidth*e)+.5,e=.5+(t.z-this.offsetZ)/(this.currentLineHeight*e),s=Math.floor(n*s);return[Math.floor(e*i),s]},t.prototype.getSpatialPosition=function(t,e){return[e*this.dopt.blockSize+this.originX,t*this.dopt.blockSize+this.originZ+this.offsetZ]},t.prototype.getPointPosition=function(t){t=this.getMatrixPosition(t);return this.getSpatialPosition(t[0],t[1])},t.prototype.config=function(t,e){this.gridPlane.scale.set(t*this.dopt.blockSize,e*this.dopt.blockSize),this.grid&&this.remove(this.grid),this.grid=this.createGrid({linesWidth:t,linesHeight:e,color:10066329}),this.originX=-this.dopt.blockSize*t*.5+.5*this.dopt.blockSize,this.originZ=-this.dopt.blockSize*e*.5+.5*this.dopt.blockSize,this.offsetZ=0,this.currentLineWidth=t,this.currentLineHeight=e,this.selfAlign()},t.prototype.getMatrixPosition=function(t){var e=this.dopt.blockSize,i=this.currentLineHeight,s=this.currentLineWidth,n=t.x/(this.currentLineWidth*e)+.5,e=.5+(t.z-this.offsetZ)/(this.currentLineHeight*e),s=Math.floor(n*s);return[Math.floor(e*i),s]},t.prototype.getSpatialPosition=function(t,e){var i=this.dopt.blockSize;return[e*i+this.originX,t*i+this.originZ+this.offsetZ]},t.prototype.getPointPosition=function(t){t=this.getMatrixPosition(t);return this.getSpatialPosition(t[0],t[1])},t.prototype.getLimitX=function(){return.5*this.currentLineWidth*this.dopt.blockSize},t.prototype.getMidLine=function(){return Math.floor(.5*this.currentLineWidth)},t.prototype.shiftForward=function(){var t=this.dopt.blockSize;this.position.z-=.25*this.currentLineHeight*t},t}),e("rs/sr3d/RunningStage",["rs/sr3d/SparkAnimation","rs/sr3d/entity/Stars","rs/sr3d/entity/ObstaclePool","rs/sr3d/entity/GiftPool","rs/sr3d/entity/Santa","rs/sr3d/entity/Floor"],function(t,e,i,s,n,o){"use strict";function r(t){this.g3d=t,this.gs=t.gs,this.dopt=t.dopt,this.am=t.am,this.init()}((r.prototype=Object.create(THREE.Group.prototype)).constructor=r).prototype.init=function(){THREE.Group.prototype.constructor.call(this);this.dopt,this.am;this.gpool=new s(this),this.gpieces=[],this.opool=new i(this),this.opieces=[],this.stars=new e(this),this.add(this.stars),this.floor=new o(this),this.floor.position.y=-7,this.add(this.floor),this.sanim=new t(this),this.sanim.position.z=2,this.add(this.sanim),this.santaList=[new n(this,1),new n(this,2),new n(this,3)]},r.prototype.prepareLevel=function(t){this.reset(),this.remove(this.santa);const e=this.santa=this.santaList[Math.floor(Math.random()*this.santaList.length)];e.reset(),e.position.y=-7,e.playWalk(),this.add(this.santa),this.generateLevel(0)},r.prototype.generateLevel=function(t){console.log("Generate level: ",t,t+40);const i=[];let e=0;for(var s=0==t?5:t;++e<=20;){let t=Math.floor(40*Math.random())+s,e=Math.floor(7*Math.random());for(;i[t]&&i[t][e];)t=Math.floor(40*Math.random())+s,e=Math.floor(7*Math.random());if(i[t]||(i[t]=[]),i[t][e]=1,0==Math.floor(2*Math.random())){const n=this.gpool.obtain();n.reset(),n.position.y=-7,this.gpieces.push(n),this.placeItem(n,-t,e)}else{const o=this.opool.obtain();o.reset(),o.position.y=-7,o.mixer&&o.playRandom(),this.opieces.push(o),this.placeItem(o,-t,e)}}};let l=new THREE.Vector3,p=new THREE.Vector3;return r.prototype.update=function(e){const i=this.santa,t=this.g3d.camera;this.sanim.update(e),i.update(e);var s=i.getMatrixPosition();for(let t=this.opieces.length-1;0<=t;t--){const r=this.opieces[t];r.mixer&&r.animate(e),r.ti-2>s[0]&&r.selfRemove()}for(let t=this.gpieces.length-1;0<=t;t--){const a=this.gpieces[t];a.ti-2>s[0]&&a.selfRemove()}for(let t=0;t<this.opieces.length;t++){const h=this.opieces[t];if(h.ti==s[0]&&h.tj==s[1]&&!h.isHit){h.hit(),i.hitObstacle(),this.gs.header.hbar.decreaseHealth()&&this.g3d.setLoseState();break}}for(let t=0;t<this.gpieces.length;t++){const c=this.gpieces[t];if(c.ti==s[0]&&c.tj==s[1]&&!c.isHit){c.hit(),this.sanim.show(),i.getWorldPosition(p),p.project(this.g3d.camera);var n=.5*this.g3d.width,o=.5*this.g3d.height,n=p.x*n+n,o=-p.y*o+o;this.g3d.cc.show(n,o,100),this.gs.header.levelBtn.setLevel(this.g3d.cc.coin);break}}l.setFromMatrixPosition(i.fpoint.matrixWorld),t.position.lerp(l,.2)},r.prototype.placeItem=function(t,e,i){var s=this.dopt.blockSize;this.add(t),t.position.x=i*s+3*-s,t.position.z=e*s,t.ti=e,t.tj=i},r.prototype.reset=function(){this.floor.selfAlign(),this.stars.position.z=0},r}),e("rs/sr3d/GameLight",[],function(){"use strict";function t(t){this.g3d=t,this.dopt=t.dopt,this.speed=this.dopt.lightMovingSpeed,this.init()}return((t.prototype=Object.create(THREE.Group.prototype)).constructor=t).prototype.init=function(){THREE.Group.prototype.constructor.call(this),this.bound=[300,400,10],this.dirX=1;var t=this.lights=[];t[0]=new THREE.PointLight(16777215,1,0),t[1]=new THREE.PointLight(16777215,1,0),t[0].position.set(0,-800,0),t[0].oZ=600,t[1].position.set(15,20,20),t[1].oZ=20,this.add(t[1]);this.g3d.scene,new THREE.PointLightHelper(t[0],20),new THREE.PointLightHelper(t[1],20);t=new THREE.AmbientLight(this.dopt.ambientLight,.95);this.add(t)},t.prototype.animate=function(){this.lights[1].position.x+=this.dirX*this.speed;var t=this.lights[1].position.x;(t>.5*this.bound[0]||t<.5*-this.bound[0])&&(this.dirX=-this.dirX)},t.prototype.transition=function(){},t.prototype.setBound=function(t,e){this.bound=t;var i=this.lights[1];i.position.set(.5*t[0],.5*-t[1],i.oZ),i.position.y=0},t}),e("rs/sr3d/Game3dContainer",["rs/sr3d/RunningStage","rs/sr3d/GameLight"],function(e,i){"use strict";function t(t){this.g3d=t,this.init()}return((t.prototype=Object.create(THREE.Group.prototype)).constructor=t).prototype.init=function(){THREE.Group.prototype.constructor.call(this),this.runningStage=new e(this.g3d),this.add(this.runningStage);var t=this.glight=new i(this.g3d);this.add(t)},t.prototype.show=function(){var t=this.g3d.dopt;this.visible=!1,this.rotation.x=0;var e=this;this.scale.set(.1,.1,.1),anime.remove(this.scale),anime({targets:this.scale,x:1,y:1,z:1,easing:"easeOutQuad",duration:1200}),this.position.y=t.verticalShift,this.position.z=-30,this.rotation.y=Math.PI;var i=2*Math.PI,t=t.shearAngle*Math.PI/180;anime.remove(this.rotation),anime({targets:this.rotation,y:i,x:t,easing:"easeOutCubic",delay:1e3,duration:2e3,complete:function(){e.rotation.y=0}}),e.visible=!0},t.prototype.setLoseState=function(){},t}),e("rs/sr3d/Game3d",["rs/three/BaseApp","rs/utils/BrowserUtil","rs/game3d/Firework3DSet","rs/sr3d/CoinCounter","rs/sr3d/Game3dContainer"],function(i,l,s,n,o){"use strict";c.prototype=Object.create(i.prototype);var r=0,a=1,t=2,e=3,h=4;function c(t){this.gs=t,this.config=t.config,this.sr3d=t.sr3d,this.dopt=this.sr3d.defaultOptions,this.am=this.sr3d.assetManager;i.prototype.constructor.call(this,500,300),this.setCameraMatchProjection(),this.defaultCursor="auto",this.buildScene(),this.initMouseDrag(),this.initMouseHandler(),this.initKeyboard()}return(c.prototype.constructor=c).prototype.enableOrbitControl=function(){this.controls=new OrbitControls(this.camera,this.el),this.controls.enableDamping=!0},c.prototype.buildScene=function(){this.container=new o(this),this.clock=new THREE.Clock,this.cc=new n;var t=this.scene;t.add(this.container),t.background=new THREE.Color(this.dopt.sceneColor),t.fog=new THREE.Fog(this.dopt.sceneColor,10,450);var e=this.am;this.f3ds=new s(this,{numParticles:3,callback:function(){e.firework.play()}}),t.add(this.f3ds),this.camera.rotation.x=0,this.f3ds.visible=!1,this.inTransition=!1,this._setUpRaycaster(),this.resizeHandler()},c.prototype.initMouseDrag=function(){var t=l.getMouseTouchEvents(),e=t.mdown,i=t.mmove,s=t.mup,n=this.el;let o,r;var a=this;this.container.runningStage;function h(t){a.isRunningState()&&(r=(t.changedTouches?t.changedTouches[0]:t).clientX,r,o)}function c(t){a.isDragging=!1,n.removeEventListener(i,h),n.removeEventListener(s,c),window.removeEventListener(i,h),window.removeEventListener(s,c)}n.addEventListener(e,function(t){a.isRunningState()&&(a.isDragging=!0,r=(t.touches?t.touches[0]:t).clientX,o=r,n.addEventListener(i,h),n.addEventListener(s,c),window.addEventListener(i,h),window.addEventListener(s,c))}),n.addEventListener("mouseover",function(t){}),this.disableDragEvent=c},c.prototype.initMouseHandler=function(){const i=this;document.body.addEventListener("pointerdown",function(t){if(i.state===r){const e=i.container.runningStage;.5<t.clientX/window.innerWidth?e.santa.shiftRight():e.santa.shiftLeft()}}),document.body.addEventListener("pointermove",function(t){})},c.prototype.initKeyboard=function(){const i=this,s=this.keyTracking=[];document.body.addEventListener("keydown",function(t){if(i.state===r){const e=i.container.runningStage;switch(t.keyCode){case 37:e.santa.shiftLeft();break;case 39:e.santa.shiftRight()}s[t.keyCode]=1}}),document.body.addEventListener("keyup",function(t){s[t.keyCode]=0})},c.prototype._setUpRaycaster=function(){const o=this.camera,r=this.raycaster,a=this.container,t=this.el,h=this;this.am,this.container.runningStage;t.addEventListener("pointerdown",function(t){var e,i=t.touches?(e=t.touches[0].clientX,t.touches[0].clientY):t.changedTouches?(e=t.changedTouches[0].clientX,t.changedTouches[0].clientY):(e=t.offsetX,t.offsetY),i={x:e/h.width*2-1,y:2*-(i/h.height)+1};r.setFromCamera(i,o);for(var s=r.intersectObjects(a.children,!0),n=0;n<s.length;n++){s[n].object;"pointerdown"==t.type&&(h.isHover=!0),t.type;break}0==s.length&&"pointermove"==t.type&&(h.isHover=!1)}),t.addEventListener("pointerup",function(t){})},c.prototype.loadLevel=function(t,e){this.disableDragEvent(),this.sr3d.inTransition=!0;var i=this.gs.levels,t=i[t=t==i.length?0:t];this.container.visible=!1,this.container.show(),this.container.runningStage.prepareLevel(t),this.camera.rotation.x=0,this.camera.position.set(0,0,40),this.setReadyState(),e.call(this)},c.prototype._renderRequest=function(){i.prototype._renderRequest.call(this);var t=this.clock.getDelta();this.controls&&this.controls.update(),this.container.glight.animate(),this.state==a&&this.f3ds.update(t);const e=this.container.runningStage;this.isReadyState()?e.santa.mixer.update(t):this.isRunningState()&&e.update(t)},c.prototype.setReadyState=function(){this.state=e},c.prototype.isReadyState=function(){return this.state==e},c.prototype.isPauseState=function(){return this.state==h},c.prototype.setPauseState=function(){this.lastState=this.state,this.state=h},c.prototype.restoreLastState=function(){this.state=this.lastState},c.prototype.setRunningState=function(){this.state=r,this.camera.rotation.x=0,this.f3ds.visible=!1,this.inTransition=!1,this.gs.header.show()},c.prototype.isRunningState=function(){return this.state==r},c.prototype.setWonState=function(){this.state=a,this.inTransition=!0;var t=this.container.runningStage;t.gi.lose(),t.astronaut.win(),this.f3ds.visible=!0,this.f3ds.reset(),this.f3ds.position.z=t.astronaut.position.z-1e3,this.gs.header.hide(),this.gs.showWonBar(),this.am.wintune.play(),this.am.yahoo.play(),this.gs.unlockNextLevel()},c.prototype.setLoseState=function(){this.state=t,this.inTransition=!0,this.container.setLoseState(),this.gs.header.hide(),this.gs.showLoseBar(),this.am.losetune.play()},c.prototype.getCurrentScore=function(){return this.cc.coin},c.prototype.resize=function(t,e){this.width=t,this.height=e,this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e),this.resizeHandler(),this.camera.position.z=40,this.f3ds.changeRegion(t,e)},c.prototype.resizeHandler=function(t){i.prototype.resizeHandler.call(this),this.setCameraMatchProjection()},c.prototype.show=function(){this.el.style.display="block"},c.prototype.hide=function(){this.el.style.display="none"},c.prototype.destroy=function(){},c}),e("rs/sr3d/screen/GameScreen",["rs/game/ImagePanel","rs/sr3d/ReadyPanel","rs/sr3d/ui/GameOverPanel","rs/sr3d/ui/HelpPanel","rs/sr3d/ui/GameScreenButtonBar","rs/sr3d/ui/GameScreenWonBar","rs/sr3d/ui/GameScreenLoseBar","rs/sr3d/ui/GameScreenHeader","rs/sr3d/Game3d"],function(e,i,s,n,o,r,a,h,c){"use strict";function t(t,e){this.sr3d=t,this.am=t.assetManager,this.config=t.config,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-gscreen",t.style.width=t.style.height="100%",t.style.display="none";var e=this.config.data.level;this.levels=e,this.initPanel(),this.header=new h(this),t.appendChild(this.header.el),this.bbar=new o(this),t.appendChild(this.bbar.el),this.wbar=new r(this),t.appendChild(this.wbar.el),this.lbar=new a(this),t.appendChild(this.lbar.el),this.game3d=new c(this),t.appendChild(this.game3d.el),this.currentLevel=0},t.prototype.initPanel=function(){var t=this;this.imagePanel=new e(this.applyNewLevel.bind(this)),this.rpanel=new i(this),this.gopanel=new s(this),this.hpanel=new n(function(){t.game3d.restoreLastState()})},t.prototype.loadLevel=function(t){const e=this;this.gopanel.hide(),this.rpanel.hide(),this.wbar.hide(),this.lbar.hide(),this.showButtonBar(),this.sr3d.showPreloader(),this.game3d.loadLevel(t,function(){e.sr3d.hidePreloader(),e.reset(),e.header.levelBtn.setLevel(t+1),e.rpanel.countDown(function(){var t=e.game3d;t.isReadyState()?t.setRunningState():t.isPauseState()&&(t.setRunningState(),t.setPauseState())})}),this.currentLevel=t},t.prototype.replayLevel=function(){this.loadLevel(this.currentLevel)},t.prototype.nextLevel=function(){var t=this.currentLevel+1;t==this.levels.length&&(t=0),this.loadLevel(t)},t.prototype.unlockNextLevel=function(){var t=this.currentLevel+1;t<this.levels.length&&this.sr3d.pref.saveUnlock(t)},t.prototype.getCurrentImagePath=function(){var t=this.levels[this.currentCategory].content[this.currentLevel].path;return t=null==t?this.game3d.container.puzzleBoard.dataUrl:t},t.prototype.reset=function(){this.header.hbar.reset(),this.game3d.cc.reset()},t.prototype.applyNewLevel=function(t){this.currentCategory=0,this.sr3d.root.appendChild(this.el),this.transitionIn();var e=this.sr3d.getAppDimension();this.game3d.resize(e[0],e[1]),this.game3d.startRendering(),this.loadLevel(t=null==t?0:t)},t.prototype.show=function(){this.imagePanel.show("assets/graphics/tutor.png")},t.prototype.hide=function(){this.sr3d.root.removeChild(this.el),this.game3d.stopRendering()},t.prototype.showWonBar=function(){this.bbar.hide();var t=this.wbar;setTimeout(function(){t.show("LEVEL PASSED")},400)},t.prototype.showLoseBar=function(){this.bbar.hide();var t=this.lbar;setTimeout(function(){t.show("Game Over")},400),this.gopanel.show()},t.prototype.getBestScore=function(){return this.game3d.cc.coin},t.prototype.showButtonBar=function(){this.wbar.hide();var t=this.bbar;setTimeout(function(){t.show()},400)},t.prototype.transitionIn=function(){this.el.style.display="block"},t.prototype.transitionOut=function(){},t.prototype.resize=function(t,e){this.game3d.resize(t,e)},t.prototype.startCounter=function(){this.header.dbar.start()},t.prototype.dispose=function(){},t}),e("rs/ui/RingPreloader",["rs/utils/ObjectUtil"],function(e){"use strict";function t(t){this.dopt={size:40,borderWidth:6,borderColor:"#AAA"},e.merge(t,this.dopt),this.build()}return t.prototype.build=function(){var t=this.dopt,e=this.el=document.createElement("div");e.className="rs-ringpreloader",e.innerHTML="<div class='lds-ring'><div></div><div></div><div></div><div></div></div>",e.style.marginLeft=e.style.marginTop=.5*-t.size+"px";for(var i=e.firstChild.children,s=0;s<i.length;s++){var n=i[s].style;n.width=n.height=t.size+"px",n.borderWidth=t.borderWidth+"px",n.borderTopColor=t.borderColor}},t.prototype.show=function(){this.el.style.display="block"},t.prototype.hide=function(){this.el.style.display="none"},t}),e("rs/sr3d/SantaRun",["rs/sr3d/Preferences","rs/sr3d/AssetManager","rs/sr3d/screen/HomeScreen","rs/sr3d/screen/GameScreen","rs/ui/RingPreloader","rs/utils/ObjectUtil","rs/utils/BrowserUtil"],function(t,e,i,s,n,o,r){"use strict";function a(t,e){this.loadConfig(),this.isMobile=r.isMobile(),this.defaultOptions={blockSize:14,sceneColor:1056051,fitFactor:1,ambientLight:16777215,verticalShift:-20,shearAngle:20,lightMovingSpeed:3,santaSpeed:90,deerSpeed:150,maxHealth:3},o.merge(e=e||{},this.defaultOptions),this.root=t,r.css(this.root,{position:"relative",display:"block",overflow:"hidden"});const i=this;window.addEventListener("resize",function(){i.resize()}),document.body.addEventListener("click",function(t){})}return a.prototype.loadConfig=function(){var i=this,t=new XMLHttpRequest;t.addEventListener("load",function(t){var e=JSON.parse(this.response);i.config=e,i.initComponents()}),t.open("GET","config.json"),t.send()},a.prototype.initComponents=function(){const t=this;this.defaultOptions,this.config;this.initPreferences(),this.initGameAI(),this.initPreloader(),this.activeScreen=null,this.assetManager=new e(this),window.location.search.includes("bypass")?(this.assetManager.onLoad=function(){t.setGameScreen()},this.assetManager.load()):this.setHomeScreen(),setTimeout(function(){t.resize()},200)},a.prototype.initPreferences=function(){this.pref=new t(this.config,localStorage.getItem("SantaRun"))},a.prototype.initGameAI=function(){},a.prototype.initPreloader=function(){var t=new n({borderColor:"#ccc"}).el;(this.preloader=t).style.top="50%"},a.prototype.showPreloader=function(){this.root.appendChild(this.preloader)},a.prototype.hidePreloader=function(){this.root.contains(this.preloader)&&this.root.removeChild(this.preloader)},a.prototype.initFullcreen=function(){this.fsbtn=new FullscreenButton(this.root,function(t){console.log("fullsceen change")}),this.root.appendChild(this.fsbtn.el)},a.prototype.addEventListener=function(t,e){this.root.addEventListener(t,e)},a.prototype.setScreen=function(t){this.activeScreen&&this.activeScreen.hide(),t.show(),this.activeScreen=t},a.prototype.setGameScreen=function(){this.gameScreen||(this.gameScreen=new s(this)),this.setScreen(this.gameScreen)},a.prototype.setHomeScreen=function(){this.homeScreen||(this.homeScreen=new i(this)),this.setScreen(this.homeScreen)},a.prototype.dispose=function(){},a.prototype.resize=function(){var t=this.getAppDimension(),e=t[0],t=t[1];this.activeScreen&&this.activeScreen.resize(e,t)},a.prototype.getAppDimension=function(){var t=r.computeStyle,e=t(this.root,"borderTopWidth");return[t(this.root,"width")-2*e,t(this.root,"height")-2*e]},a}),window.SantaRun=t("rs/sr3d/SantaRun")}();